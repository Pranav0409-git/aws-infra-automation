pipeline {
agent any

environment {
AWS_DEFAULT_REGION = 'us-east-1'
}

stages {

stage('Terraform Init') {
  steps {
    withAWS(credentials: 'aws-cred', region: 'us-east-1') {
      sh 'terraform init'
    }
  }
}

stage('Terraform Plan') {
  steps {
    withAWS(credentials: 'aws-cred', region: 'us-east-1') {
      sh 'terraform plan'
    }
  }
}

stage('Terraform Apply') {
  steps {
    withAWS(credentials: 'aws-cred', region: 'us-east-1') {
      sh 'terraform apply -auto-approve'
    }
  }
}

}
}
